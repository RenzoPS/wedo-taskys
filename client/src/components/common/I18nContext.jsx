import { createContext, useContext, useEffect, useMemo, useState } from "react";

const DEFAULT_LANG = "es";

const resources = {
  es: {
    nav: { home: "Inicio", features: "Características", how: "Cómo funciona", faq: "FAQ" },
    auth: { login: "Iniciar sesión", register: "Registrarse", logout: "Cerrar sesión" },
    header: { myGroups: "Mis Grupos" },
    hero: {
      title: "Organiza tareas en equipo de forma simple y efectiva",
      subtitle:
        "WeDo Taskys te ayuda a coordinar proyectos, distribuir responsabilidades y hacer seguimiento del progreso en tiempo real.",
      start: "Comenzar ahora",
      demo: "Ver demostración",
      goGroups: "Ir a Mis Grupos",
      loginOrRegister: "Iniciar sesión o Registrarse",
      groupTitle: "Grupos de Trabajo",
      groupSubtitle: "Gestiona tus grupos, colabora y comparte tareas con tu equipo.",
      needLogin: "Debes iniciar sesión o registrarte para acceder a tus grupos."
    },
    features: { title: "Características principales" },
    how: {
      title: "Cómo funciona",
      subtitle: "Descubre la experiencia de WeDo en tres simples pasos",
      step1Title: "Crea tu cuenta",
      step1Desc: "Regístrate en segundos con tu correo electrónico o cuenta de Google. Configura tu perfil y personaliza tus preferencias.",
      step2Title: "Crea tu primer proyecto",
      step2Desc: "Configura un nuevo proyecto, invita a los miembros de tu equipo y comienza a crear tareas. Organiza todo según tus necesidades.",
      step3Title: "Colabora y haz seguimiento",
      step3Desc: "Trabaja con tu equipo en tiempo real, asigna tareas, comenta y haz seguimiento del progreso. Recibe notificaciones y mantente al día con todo."
    },
    footer: { tagline: "Organiza tareas en equipo de forma simple y efectiva." },
    faq: {
      title: "Preguntas Frecuentes",
      subtitle: "Encuentra respuestas a las preguntas más comunes sobre WeDo",
      q1: "¿Qué es WeDo y cómo puede ayudar a mi equipo?",
      a1: "WeDo es una plataforma de gestión de tareas para equipos. Crea, asigna y hace seguimiento de tareas en tiempo real, facilitando la colaboración y la productividad.",
      q2: "¿Es gratuito usar WeDo?",
      a2: "Ofrecemos un plan gratuito con funcionalidades básicas y planes premium con características avanzadas como reportes e integraciones.",
      q3: "¿Puedo invitar a miembros de mi equipo?",
      a3: "Sí, puedes invitar a tu equipo por correo, asignar roles y permisos y colaborar en tiempo real.",
      q4: "¿Cómo funciona la colaboración en tiempo real?",
      a4: "Los cambios se sincronizan al instante. Recibe notificaciones, comenta y comparte archivos en cada tarea.",
      q5: "¿Qué tipos de proyectos puedo gestionar?",
      a5: "WeDo se adapta a cualquier proyecto: software, marketing, diseño, eventos, investigación y más. Personaliza tableros, etiquetas y flujos.",
      q6: "¿Mis datos están seguros?",
      a6: "Usamos cifrado, copias de seguridad y cumplimos estándares de protección de datos. Tu información está protegida.",
      q7: "¿Puedo acceder desde dispositivos móviles?",
      a7: "Sí, funciona perfecto en computadoras, tablets y smartphones. Apps nativas en camino.",
      q8: "¿Ofrecen soporte técnico?",
      a8: "Brindamos soporte por chat y correo, además de una base de conocimiento detallada.",
      contactTitle: "¿No encuentras lo que buscas?",
      contactText: "Nuestro equipo de soporte está aquí para ayudarte",
      contactButton: "Contactar Soporte"
    },
    groups: { 
      backHome: "Volver al Inicio", 
      myGroups: "Mis Grupos",
      createNewGroup: "Crear Nuevo Grupo",
      editGroup: "Editar Grupo",
      organizeWork: "Organiza tu trabajo en equipo de manera eficiente",
      modifyInfo: "Modifica la información del grupo",
      groupName: "Nombre del Grupo *",
      groupNamePlaceholder: "Ej: Proyecto Marketing 2024",
      description: "Descripción",
      descriptionPlaceholder: "Describe el propósito del grupo...",
      cancel: "Cancelar",
      createGroup: "Crear Grupo",
      updateGroup: "Actualizar Grupo",
      creating: "Creando...",
      updating: "Actualizando...",
      errorCreate: "Error al crear el grupo",
      errorUpdate: "Error al actualizar el grupo",
      viewDetails: "Ver detalles",
      viewLists: "Ver listas",
      manage: "Gestionar",
      groupInfo: "Información del Grupo",
      members: "Miembros:",
      created: "Creado:",
      owner: "Propietario:",
      moreMembers: "+{{count}} más",
      fullManagementPanel: "Panel de Gestión Completo",
      closePanel: "Cerrar panel",
      edit: "Editar",
      save: "Guardar Cambios",
      saving: "Guardando...",
      name: "Nombre:",
      noDescription: "Sin descripción",
      lastUpdate: "Última actualización:",
      membersManagement: "Gestión de Miembros",
      total: "Total:",
      add: "Agregar",
      makeAdmin: "Hacer admin",
      removeAdmin: "Quitar admin",
      removeFromGroup: "Remover del grupo",
      noMembers: "No hay miembros en este grupo",
      dangerZone: "⚠️ Zona de Peligro",
      dangerDesc: "Esta acción eliminará permanentemente el grupo y todos sus datos asociados.",
      deleteGroup: "Eliminar Grupo",
      confirmDelete: "¿Estás seguro de que quieres eliminar este grupo? Esta acción no se puede deshacer.",
      confirmRemoveUser: "¿Estás seguro de que quieres remover a {{name}} del grupo?",
      addUserTo: "Agregar Usuario a \"{{group}}\"",
      loadingUsers: "Cargando usuarios disponibles...",
      noUsersAvailable: "No hay usuarios disponibles para agregar",
      adding: "Agregando...",
      errorLoadingUsers: "Error al cargar usuarios disponibles",
      errorAddingUser: "Error al agregar usuario",
      admin: "Admin",
      member: "Miembro"
    },
    register: { tagline: "Organiza tareas en equipo, logra más juntos", registering: "Registrando..." },
    login: { tagline: "Organiza tareas en equipo, logra más juntos", loggingIn: "Iniciando sesión..." },
    lang: { es: "Español", en: "English" },
    form: {
      email: "Correo Electrónico",
      username: "Nombre de usuario",
      password: "Contraseña",
      confirmPassword: "Confirmar contraseña",
      emailPlaceholder: "usuario@ejemplo.com",
      usernamePlaceholder: "Tu nombre de usuario",
      forgotPassword: "¿Olvidaste tu contraseña?",
      noAccount: "¿No tienes una cuenta?",
      signUpNow: "Regístrate ahora",
      haveAccount: "¿Ya tienes una cuenta?",
      signIn: "Inicia Sesión"
    },
    clientMessages: {
      registerSuccess: "¡Registro exitoso! Bienvenido {{name}}!",
      errorLogin: "Error al iniciar sesión",
      errorRegister: "Error al registrarse",
      passwordsDontMatch: "Las contraseñas no coinciden",
      passwordMin: "La contraseña debe tener al menos 6 caracteres"
    },
    authPage: {
      illustrationTitle: "Colabora sin límites",
      illustrationText: "Organiza, asigna y completa tareas en equipo. WeDo Taskys hace que el trabajo colaborativo sea simple y efectivo."
    },
    lists: {
      backToGroups: "Volver a grupos",
      readOnly: "Solo lectura",
      changeBackground: "Cambiar fondo",
      addBackground: "Agregar fondo",
      createNewList: "Crear nueva lista",
      noLists: "No hay listas en este grupo",
      createListToStart: "Crea una nueva lista para comenzar a organizar tus tareas.",
      noListsYet: "Aún no hay listas en este grupo.",
      onlyOwnerCanManage: "Solo el propietario y administradores pueden crear y gestionar listas.",
      editList: "Editar lista",
      createList: "Crear nueva lista",
      listTitle: "Título de la lista",
      listTitlePlaceholder: "Ingresa un título para la lista",
      titleRequired: "El título es obligatorio",
      cancel: "Cancelar",
      saveChanges: "Guardar cambios",
      create: "Crear lista",
      confirmDeleteList: "¿Estás seguro de que deseas eliminar la lista \"{{title}}\"?",
      confirmDeleteListWithTasks: "La lista \"{{title}}\" contiene {{count}} tareas. ¿Estás seguro de que deseas eliminarla de todas formas?",
      errorLoadInfo: "No se pudo cargar la información. Por favor, intenta de nuevo.",
      errorNoPermissionCreate: "No tienes permisos para crear listas.",
      errorCreateList: "No se pudo crear la lista. Por favor, intenta de nuevo.",
      errorNoPermissionEdit: "No tienes permisos para editar listas.",
      errorUpdateList: "No se pudo actualizar la lista. Por favor, intenta de nuevo.",
      errorNoPermissionDelete: "No tienes permisos para eliminar listas.",
      errorDeleteList: "No se pudo eliminar la lista. Por favor, intenta de nuevo.",
      errorUpdateBackground: "No se pudo actualizar la imagen.",
      backgroundPrompt: "Ingresá la URL de la imagen de fondo (dejá vacío para eliminar):",
      error: "Error",
      closeError: "Cerrar error"
    },
    tasks: {
      backToLists: "Volver a listas",
      readOnly: "Solo lectura",
      group: "Grupo:",
      createNewTask: "Crear nueva tarea",
      noTasks: "No hay tareas en esta lista",
      createTaskToStart: "Crea una nueva tarea para comenzar a organizar tu trabajo.",
      noTasksYet: "Aún no hay tareas en esta lista.",
      onlyOwnerCanManage: "Solo el propietario y administradores pueden crear y gestionar tareas.",
      errorLoadInfo: "No se pudo cargar la información. Por favor, intenta de nuevo.",
      errorNoPermissionCreate: "No tienes permisos para crear tareas.",
      errorCreateTask: "No se pudo crear la tarea. Por favor, intenta de nuevo.",
      errorNoPermissionEdit: "No tienes permisos para editar tareas.",
      errorUpdateTask: "No se pudo actualizar la tarea. Por favor, intenta de nuevo.",
      errorNoPermissionDelete: "No tienes permisos para eliminar tareas.",
      errorDeleteTask: "No se pudo eliminar la tarea.",
      errorUpdateStatus: "No se pudo actualizar el estado de la tarea.",
      error: "Error",
      closeError: "Cerrar error",
      // CreateTaskForm
      createTask: "Crear Nueva Tarea",
      editTask: "Editar Tarea",
      organizeWork: "Organiza tu trabajo de manera eficiente",
      modifyTask: "Modifica la información de la tarea",
      taskTitle: "Título de la Tarea *",
      taskTitlePlaceholder: "Ej: Diseñar mockups de la aplicación",
      description: "Descripción",
      descriptionPlaceholder: "Describe los detalles de la tarea...",
      dueDate: "Fecha de Vencimiento",
      priority: "Prioridad",
      low: "Baja",
      medium: "Media",
      high: "Alta",
      cancel: "Cancelar",
      create: "Crear Tarea",
      update: "Actualizar Tarea",
      creating: "Creando...",
      updating: "Actualizando...",
      // TaskCard
      completed: "Completada",
      pending: "Pendiente",
      edit: "Editar",
      delete: "Eliminar",
      confirmDelete: "¿Estás seguro de que deseas eliminar esta tarea?",
      noDueDate: "Sin fecha límite",
      // TaskDetailModal
      taskDetails: "Detalles de la Tarea",
      close: "Cerrar",
      markComplete: "Marcar como completada",
      markIncomplete: "Marcar como pendiente",
      save: "Guardar Cambios",
      saving: "Guardando...",
      status: "Estado:",
      assignedTo: "Asignado a:",
      createdBy: "Creado por:",
      createdAt: "Creado:",
      updatedAt: "Última actualización:",
      noDescription: "Sin descripción",
      notAssigned: "No asignado",
      // TaskDetailModal
      unsavedChanges: "Cambios sin guardar",
      confirmUnsavedChanges: "Tenés cambios sin guardar. ¿Querés salir sin guardar?",
      assignment: "Asignación",
      selectGroupUser: "Seleccionar usuario del grupo",
      assign: "Asignar",
      assigning: "Asignando...",
      assigned: "Asignados",
      removeAssignment: "Quitar asignación",
      taskAssignedSuccess: "Tarea asignada correctamente",
      errorAssign: "No se pudo asignar la tarea",
      errorUnassign: "No se pudo desasignar la tarea",
      changesSavedSuccess: "Cambios guardados exitosamente",
      errorSavingChanges: "Error al guardar los cambios",
      tags: "Etiquetas",
      tagNamePlaceholder: "Nombre de la etiqueta (Enter para crear)",
      checklistTitlePlaceholder: "Título de la checklist (Enter para crear)",
      confirmDeleteChecklist: "¿Eliminar esta checklist?",
      addTask: "Agregar tarea",
      noTasks: "No hay tareas",
      editList: "Editar lista",
      deleteList: "Eliminar lista",
      addElement: "Agregar elemento",
      newElementPlaceholder: "Nuevo elemento (Enter para agregar)"
    }
  },
  en: {
    nav: { home: "Home", features: "Features", how: "How it works", faq: "FAQ" },
    auth: { login: "Sign in", register: "Sign up", logout: "Log out" },
    header: { myGroups: "My Groups" },
    hero: {
      title: "Organize team tasks simply and effectively",
      subtitle:
        "WeDo Taskys helps you coordinate projects, distribute responsibilities, and track progress in real time.",
      start: "Start now",
      demo: "View demo",
      goGroups: "Go to My Groups",
      loginOrRegister: "Sign in or Sign up",
      groupTitle: "Work Groups",
      groupSubtitle: "Manage your groups, collaborate and share tasks with your team.",
      needLogin: "You must sign in or sign up to access your groups."
    },
    features: { title: "Key features" },
    how: {
      title: "How it works",
      subtitle: "Discover the WeDo experience in three simple steps",
      step1Title: "Create your account",
      step1Desc: "Sign up in seconds with your email or Google account. Set up your profile and preferences.",
      step2Title: "Create your first project",
      step2Desc: "Set up a new project, invite team members and start creating tasks. Organize everything to your needs.",
      step3Title: "Collaborate and track progress",
      step3Desc: "Work with your team in real time, assign tasks, comment and track progress. Get notifications and stay up to date."
    },
    footer: { tagline: "Organize team tasks simply and effectively." },
    faq: {
      title: "Frequently Asked Questions",
      subtitle: "Find answers to the most common questions about WeDo",
      q1: "What is WeDo and how can it help my team?",
      a1: "WeDo is a task management platform for teams. Create, assign and track tasks in real time to improve collaboration and productivity.",
      q2: "Is WeDo free to use?",
      a2: "We offer a free plan with basic features and premium plans with advanced capabilities such as reports and integrations.",
      q3: "Can I invite team members?",
      a3: "Yes, invite team members by email, assign roles and permissions, and collaborate in real time.",
      q4: "How does real-time collaboration work?",
      a4: "Changes sync instantly. Receive notifications, comment, and share files on each task.",
      q5: "What types of projects can I manage?",
      a5: "WeDo adapts to any project: software, marketing, design, events, research, and more. Customize boards, labels, and workflows.",
      q6: "Is my data secure?",
      a6: "We use encryption, backups, and comply with data protection standards. Your information is protected.",
      q7: "Can I access from mobile devices?",
      a7: "Yes, it works great on desktops, tablets, and smartphones. Native apps are on the way.",
      q8: "Do you offer technical support?",
      a8: "We provide support via live chat and email, plus a detailed knowledge base.",
      contactTitle: "Can't find what you're looking for?",
      contactText: "Our support team is here to help",
      contactButton: "Contact Support"
    },
    groups: { 
      backHome: "Back to Home", 
      myGroups: "My Groups",
      createNewGroup: "Create New Group",
      editGroup: "Edit Group",
      organizeWork: "Organize your teamwork efficiently",
      modifyInfo: "Modify the group's information",
      groupName: "Group Name *",
      groupNamePlaceholder: "E.g.: Marketing Project 2024",
      description: "Description",
      descriptionPlaceholder: "Describe the group's purpose...",
      cancel: "Cancel",
      createGroup: "Create Group",
      updateGroup: "Update Group",
      creating: "Creating...",
      updating: "Updating...",
      errorCreate: "Error creating the group",
      errorUpdate: "Error updating the group",
      viewDetails: "View details",
      viewLists: "View lists",
      manage: "Manage",
      groupInfo: "Group Information",
      members: "Members:",
      created: "Created:",
      owner: "Owner:",
      moreMembers: "+{{count}} more",
      fullManagementPanel: "Full Management Panel",
      closePanel: "Close panel",
      edit: "Edit",
      save: "Save Changes",
      saving: "Saving...",
      name: "Name:",
      noDescription: "No description",
      lastUpdate: "Last update:",
      membersManagement: "Members Management",
      total: "Total:",
      add: "Add",
      makeAdmin: "Make admin",
      removeAdmin: "Remove admin",
      removeFromGroup: "Remove from group",
      noMembers: "There are no members in this group",
      dangerZone: "⚠️ Danger Zone",
      dangerDesc: "This action will permanently delete the group and all its associated data.",
      deleteGroup: "Delete Group",
      confirmDelete: "Are you sure you want to delete this group? This action cannot be undone.",
      confirmRemoveUser: "Are you sure you want to remove {{name}} from the group?",
      addUserTo: "Add User to \"{{group}}\"",
      loadingUsers: "Loading available users...",
      noUsersAvailable: "There are no users available to add",
      adding: "Adding...",
      errorLoadingUsers: "Error loading available users",
      errorAddingUser: "Error adding user",
      admin: "Admin",
      member: "Member"
    },
    register: { tagline: "Organize team tasks, achieve more together", registering: "Signing up..." },
    login: { tagline: "Organize team tasks, achieve more together", loggingIn: "Signing in..." },
    lang: { es: "Español", en: "English" },
    form: {
      email: "Email",
      username: "Username",
      password: "Password",
      confirmPassword: "Confirm password",
      emailPlaceholder: "user@example.com",
      usernamePlaceholder: "Your username",
      forgotPassword: "Forgot your password?",
      noAccount: "Don't have an account?",
      signUpNow: "Sign up now",
      haveAccount: "Already have an account?",
      signIn: "Sign in"
    },
    clientMessages: {
      registerSuccess: "Sign up successful! Welcome {{name}}!",
      errorLogin: "Error signing in",
      errorRegister: "Error signing up",
      passwordsDontMatch: "Passwords do not match",
      passwordMin: "Password must be at least 6 characters"
    },
    authPage: {
      illustrationTitle: "Collaborate without limits",
      illustrationText: "Organize, assign and complete tasks as a team. WeDo Taskys makes collaborative work simple and effective."
    },
    lists: {
      backToGroups: "Back to groups",
      readOnly: "Read only",
      changeBackground: "Change background",
      addBackground: "Add background",
      createNewList: "Create new list",
      noLists: "No lists in this group",
      createListToStart: "Create a new list to start organizing your tasks.",
      noListsYet: "There are no lists in this group yet.",
      onlyOwnerCanManage: "Only the owner and administrators can create and manage lists.",
      editList: "Edit list",
      createList: "Create new list",
      listTitle: "List title",
      listTitlePlaceholder: "Enter a title for the list",
      titleRequired: "Title is required",
      cancel: "Cancel",
      saveChanges: "Save changes",
      create: "Create list",
      confirmDeleteList: "Are you sure you want to delete the list \"{{title}}\"?",
      confirmDeleteListWithTasks: "The list \"{{title}}\" contains {{count}} tasks. Are you sure you want to delete it anyway?",
      errorLoadInfo: "Could not load information. Please try again.",
      errorNoPermissionCreate: "You do not have permission to create lists.",
      errorCreateList: "Could not create the list. Please try again.",
      errorNoPermissionEdit: "You do not have permission to edit lists.",
      errorUpdateList: "Could not update the list. Please try again.",
      errorNoPermissionDelete: "You do not have permission to delete lists.",
      errorDeleteList: "Could not delete the list. Please try again.",
      errorUpdateBackground: "Could not update the image.",
      backgroundPrompt: "Enter the background image URL (leave empty to remove):",
      error: "Error",
      closeError: "Close error"
    },
    tasks: {
      backToLists: "Back to lists",
      readOnly: "Read only",
      group: "Group:",
      createNewTask: "Create new task",
      noTasks: "No tasks in this list",
      createTaskToStart: "Create a new task to start organizing your work.",
      noTasksYet: "There are no tasks in this list yet.",
      onlyOwnerCanManage: "Only the owner and administrators can create and manage tasks.",
      errorLoadInfo: "Could not load information. Please try again.",
      errorNoPermissionCreate: "You do not have permission to create tasks.",
      errorCreateTask: "Could not create the task. Please try again.",
      errorNoPermissionEdit: "You do not have permission to edit tasks.",
      errorUpdateTask: "Could not update the task. Please try again.",
      errorNoPermissionDelete: "You do not have permission to delete tasks.",
      errorDeleteTask: "Could not delete the task.",
      errorUpdateStatus: "Could not update the task status.",
      error: "Error",
      closeError: "Close error",
      // CreateTaskForm
      createTask: "Create New Task",
      editTask: "Edit Task",
      organizeWork: "Organize your work efficiently",
      modifyTask: "Modify the task information",
      taskTitle: "Task Title *",
      taskTitlePlaceholder: "E.g.: Design app mockups",
      description: "Description",
      descriptionPlaceholder: "Describe the task details...",
      dueDate: "Due Date",
      priority: "Priority",
      low: "Low",
      medium: "Medium",
      high: "High",
      cancel: "Cancel",
      create: "Create Task",
      update: "Update Task",
      creating: "Creating...",
      updating: "Updating...",
      // TaskCard
      completed: "Completed",
      pending: "Pending",
      edit: "Edit",
      delete: "Delete",
      confirmDelete: "Are you sure you want to delete this task?",
      noDueDate: "No due date",
      // TaskDetailModal
      taskDetails: "Task Details",
      close: "Close",
      markComplete: "Mark as completed",
      markIncomplete: "Mark as pending",
      save: "Save Changes",
      saving: "Saving...",
      status: "Status:",
      assignedTo: "Assigned to:",
      createdBy: "Created by:",
      createdAt: "Created:",
      updatedAt: "Last update:",
      noDescription: "No description",
      notAssigned: "Not assigned",
      // TaskDetailModal
      unsavedChanges: "Unsaved changes",
      confirmUnsavedChanges: "You have unsaved changes. Do you want to leave without saving?",
      assignment: "Assignment",
      selectGroupUser: "Select group user",
      assign: "Assign",
      assigning: "Assigning...",
      assigned: "Assigned",
      removeAssignment: "Remove assignment",
      taskAssignedSuccess: "Task assigned successfully",
      errorAssign: "Could not assign the task",
      errorUnassign: "Could not unassign the task",
      changesSavedSuccess: "Changes saved successfully",
      errorSavingChanges: "Error saving changes",
      tags: "Tags",
      tagNamePlaceholder: "Tag name (Enter to create)",
      checklistTitlePlaceholder: "Checklist title (Enter to create)",
      confirmDeleteChecklist: "Delete this checklist?",
      addTask: "Add task",
      noTasks: "No tasks",
      editList: "Edit list",
      deleteList: "Delete list",
      addElement: "Add element",
      newElementPlaceholder: "New element (Enter to add)"
    }
  }
};

const I18nContext = createContext({ t: (key) => key, lang: DEFAULT_LANG, setLang: () => {} });

export function I18nProvider({ children }) {
  const [lang, setLang] = useState(() => localStorage.getItem("preferredLanguage") || DEFAULT_LANG);

  useEffect(() => {
    localStorage.setItem("preferredLanguage", lang);
    document.documentElement.lang = lang;
  }, [lang]);

  const t = useMemo(() => {
    const dict = resources[lang] || resources[DEFAULT_LANG];
    return function translate(path) {
      const segments = path.split(".");
      let node = dict;
      for (const seg of segments) {
        if (node && Object.prototype.hasOwnProperty.call(node, seg)) node = node[seg];
        else return path;
      }
      return typeof node === "string" ? node : path;
    };
  }, [lang]);

  const value = useMemo(() => ({ t, lang, setLang }), [t, lang]);
  return <I18nContext.Provider value={value}>{children}</I18nContext.Provider>;
}

export function useI18n() {
  return useContext(I18nContext);
}

export default I18nContext;


